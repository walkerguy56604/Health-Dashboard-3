<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Health Dashboard 3</title>
  <style>
    body { font-family: Arial, sans-serif; background-color:#f7f8fa; color:#0f172a; padding:20px; }
    h1 { text-align:center; }
    label,input,button { display:block; margin-bottom:10px; font-size:16px; }
    #dailySummaryOutput, #trendContainer { margin-top:20px; padding:15px; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    canvas{ width:100%; height:250px; }
    #historyList{ margin-top:20px; display:flex; flex-wrap:wrap; gap:5px; }
    #historyList button{ padding:5px 10px; font-size:14px; cursor:pointer; }
    #exportContainer{ margin-top:15px; display:flex; gap:10px; flex-wrap:wrap; }
  </style>
</head>
<body>
  <h1>Health Dashboard 3</h1>

  <label for="datePicker">Select Date:</label>
  <input type="date" id="datePicker">

  <div id="dailySummaryOutput"></div>

  <h2>History</h2>
  <div id="historyList"></div>

  <div id="trendContainer">
    <h2>Blood Pressure Trends</h2>
    <canvas id="trendChart"></canvas>
  </div>

  <div id="exportContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module">
    import { renderDailySummary, renderBPTrends, exportSelectedCSV, createTodayButton } from './app.js';

    const picker = document.getElementById("datePicker");
    const today = new Date().toISOString().split('T')[0];
    picker.value = today;

    // Initial render
    renderDailySummary(today);
    renderBPTrends(today,7);
    createTodayButton();

    // Date picker change
    picker.addEventListener("change", e=>{
      const date = e.target.value;
      renderDailySummary(date);
      renderBPTrends(date,7);
      createTodayButton();
    });

    // Export buttons
    const exportContainer = document.getElementById("exportContainer");

    const exportCSVBtn = document.createElement('button');
    exportCSVBtn.textContent = 'Export Selected Date CSV';
    exportCSVBtn.onclick = () => exportSelectedCSV(picker.value);
    exportContainer.appendChild(exportCSVBtn);

    const exportJSONBtn = document.createElement('button');
    exportJSONBtn.textContent = 'Export All JSON';
    exportJSONBtn.onclick = () => alert("Use JSON export in App.js buttons section.");
    exportContainer.appendChild(exportJSONBtn);

    // Apple Health import
    const appleInput = document.createElement('input');
    appleInput.type = 'file';
    appleInput.accept = '.json';
    appleInput.onchange = (e) => {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const jsonData = JSON.parse(event.target.result);
          if(typeof window.mapAppleHealthData === "function"){
            window.mapAppleHealthData(jsonData);
            alert("Apple Health data imported!");
          } else {
            alert("mapAppleHealthData function not defined in App.js");
          }
        } catch(err) {
          alert("Error parsing JSON: " + err.message);
        }
      };
      reader.readAsText(file);
    };
    exportContainer.appendChild(appleInput);

  </script>
</body>
</html>
